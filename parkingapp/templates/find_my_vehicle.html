{% extends 'base.html' %}
{% load static %}

{% block title %}Find My Vehicle{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2 class="mb-4">üöó Find My Vehicle</h2>
    
    {% if active_session %}
    <!-- Active Session Found -->
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <h4 class="alert-heading">‚úì Vehicle Located!</h4>
        <div class="row">
            <div class="col-md-6">
                <p><strong>Parking Lot:</strong> {{ active_session.parking_lot.lot_name }}</p>
                <p><strong>Spot:</strong> {% if active_session.parking_spot %}{{ active_session.parking_spot.spot_number }}{% else %}<em>Not specified</em>{% endif %}</p>
                <p><strong>Vehicle Type:</strong> {{ active_session.vehicle_type|title }}</p>
                {% if active_session.license_plate %}
                <p><strong>License Plate:</strong> <code>{{ active_session.license_plate }}</code></p>
                {% endif %}
            </div>
            <div class="col-md-6">
                <p><strong>Parked Since:</strong> {{ active_session.entry_time|date:"Y-m-d H:i" }}</p>
                <p><strong>Duration:</strong> {{ active_session.calculate_duration }} minutes</p>
                <p><strong>Current Fee:</strong> ${{ active_session.parking_fee }}</p>
                
                <div class="mt-3">
                    <a href="{% url 'api_lot_directions' active_session.parking_lot.lot_id %}" class="btn btn-primary">
                        üìç Get Directions
                    </a>
                    <a href="{% url 'end_parking_session' active_session.session_id %}" class="btn btn-danger">
                        üöó I'm Leaving
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <!-- No Active Session -->
    <div class="alert alert-info" role="alert">
        <h4 class="alert-heading">‚ÑπÔ∏è No Active Parking Session</h4>
        <p>You don't have an active parking session. Check your recent history below.</p>
    </div>
    {% endif %}
    
    <!-- Recent Parking History -->
    <div class="card mt-4">
        <div class="card-header bg-dark text-white">
            <h5 class="mb-0">üìã Recent Parking History (Last 7 Days)</h5>
        </div>
        <div class="card-body">
            {% if recent_sessions %}
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>Lot</th>
                            <th>Entry Time</th>
                            <th>Exit Time</th>
                            <th>Duration</th>
                            <th>Spot</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for session in recent_sessions %}
                        <tr>
                            <td><strong>{{ session.parking_lot.lot_name }}</strong></td>
                            <td>{{ session.entry_time|date:"Y-m-d H:i" }}</td>
                            <td>
                                {% if session.exit_time %}
                                    {{ session.exit_time|date:"Y-m-d H:i" }}
                                {% else %}
                                    <span class="badge badge-success">Active</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if session.duration_minutes %}
                                    {{ session.duration_minutes }} min
                                {% else %}
                                    <em>-</em>
                                {% endif %}
                            </td>
                            <td>
                                {% if session.parking_spot %}
                                    <code>{{ session.parking_spot.spot_number }}</code>
                                {% else %}
                                    <em>-</em>
                                {% endif %}
                            </td>
                            <td>
                                <a href="{% url 'parking_history' %}" class="btn btn-sm btn-link">
                                    View Details
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="alert alert-info mb-0">
                No parking history in the last 7 days.
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Tips -->
    <div class="card mt-4 bg-light">
        <div class="card-body">
            <h5 class="card-title">üí° Tips</h5>
            <ul>
                <li>Enable location services for better navigation</li>
                <li>Take a photo of your spot number when parking</li>
                <li>Enable notifications to get parking reminders</li>
                <li>Share your parking location with family members</li>
            </ul>
        </div>
    </div>
</div>

<style>
    code {
        background-color: #f4f4f4;
        padding: 2px 6px;
        border-radius: 3px;
        font-size: 0.9em;
    }
</style>
{% endblock %}
